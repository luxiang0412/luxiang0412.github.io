<html>
<head>
    
    <title>DSS部署说明</title>
    <meta name="keywords" content="luxiang.org,卢翔,卢翔的blog" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <link href="/css/main.css?v=3" rel="stylesheet" type="text/css" />

    
<script src="/js/util.js"></script>

    <script>
        if (isMobile()) {
            loadjscssfile('/css/mobile.css', 'css');
        } else {
            loadjscssfile('/css/desktop.css', 'css');
        }
    </script>
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3" />
    
    
<meta name="generator" content="Hexo 4.2.0"></head>
<body>
<style>
    .highlight {
        position: relative;
    }

    .btn-copy {
        display: inline-block;
        cursor: pointer;
        background-color: #eee;
        background-image: linear-gradient(#fcfcfc, #eee);
        border: 1px solid #d5d5d5;
        border-radius: 3px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-appearance: none;
        font-size: 13px;
        font-weight: 700;
        line-height: 20px;
        color: #333;
        -webkit-transition: opacity .3s ease-in-out;
        -o-transition: opacity .3s ease-in-out;
        transition: opacity .3s ease-in-out;
        padding: 2px 6px;
        position: absolute;
        right: 5px;
        top: 5px;
        opacity: 0;
    }

    .btn-copy span {
        margin-left: 5px;
    }

    .highlight:hover .btn-copy {
        opacity: 1;
    }
</style>


<h2 class="title">DSS部署说明</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2020年12月8日




 </div>
--->
</div>

<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境说明"><span class="toc-text">环境说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置阿里云镜像源"><span class="toc-text">配置阿里云镜像源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java，Scala，Nginx安装"><span class="toc-text">Java，Scala，Nginx安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker安装"><span class="toc-text">Docker安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql安装和初始化"><span class="toc-text">Mysql安装和初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hadoop-Hive-Spark环境变量配置"><span class="toc-text">Hadoop,Hive,Spark环境变量配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Hadoop"><span class="toc-text">安装Hadoop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Hive"><span class="toc-text">安装Hive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Spark"><span class="toc-text">安装Spark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DSS安装"><span class="toc-text">DSS安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DSS启动"><span class="toc-text">DSS启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FAQ"><span class="toc-text">FAQ</span></a></li></ol>
<h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><blockquote>
<p>软件说明：  </p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">版本</th>
<th align="left">安装包名称</th>
</tr>
</thead>
<tbody><tr>
<td align="left">JDK</td>
<td align="left">1.8</td>
<td align="left">jdk-8u211-linux-x64.tar.gz</td>
</tr>
<tr>
<td align="left">Scala</td>
<td align="left">2.11.8</td>
<td align="left">scala-2.11.8.tgz</td>
</tr>
<tr>
<td align="left">Nginx</td>
<td align="left">1.18</td>
<td align="left">nginx-1.18.0-1.el7.ngx.x86_64.rpm</td>
</tr>
<tr>
<td align="left">Hadoop</td>
<td align="left">2.7.2</td>
<td align="left">hadoop-2.7.2.tar.gz</td>
</tr>
<tr>
<td align="left">Hive</td>
<td align="left">1.2.1</td>
<td align="left">apache-hive-1.2.1-bin.tar.gz</td>
</tr>
<tr>
<td align="left">Spark</td>
<td align="left">2.4.3</td>
<td align="left">spark-2.4.3-bin-2.7.2hive.tgz</td>
</tr>
<tr>
<td align="left">Centos7.6</td>
<td align="left">7.6</td>
<td align="left">CentOS-7-x86_64-Minimal-1810.iso</td>
</tr>
<tr>
<td align="left">dss_linkis.zip</td>
<td align="left"><code>Linkis_0.9.4</code>,<code>dss0.9.0</code></td>
<td align="left">dss_linkis.zip</td>
</tr>
<tr>
<td align="left">Mysql</td>
<td align="left">5.7</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">Docker</td>
<td align="left">19.03</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">docker-compose</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>服务器说明：</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">IP</th>
<th align="left">HOSTNAME</th>
<th align="left">系统版本</th>
</tr>
</thead>
<tbody><tr>
<td align="left">192.168.33.130</td>
<td align="left">centos7test</td>
<td align="left">centos7.6</td>
</tr>
</tbody></table>
<p>修改/etc/hosts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.33.130    centos7test"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#打开yarn的防火墙</span></span><br><span class="line">firewall-cmd --permanent --add-port=8088/tcp</span><br><span class="line"><span class="comment">#打开dss的防火墙</span></span><br><span class="line">firewall-cmd --permanent --add-port=9999/tcp</span><br><span class="line"><span class="comment">#打开nginx的防火墙</span></span><br><span class="line">firewall-cmd --permanent --add-port=80/tcp</span><br><span class="line"><span class="comment">#刷新规则</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>创建hadoop用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加用户</span></span><br><span class="line">useradd hadoop</span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line">vi /etc/sudoers</span><br><span class="line"><span class="comment">#添加如下规则</span></span><br><span class="line">hadoop  ALL=(ALL)       NOPASSWD: NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换用户</span></span><br><span class="line">su hadoop</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成rsa公钥</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"centos7test@sd.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#公钥写入authorized_keys</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$(cat ~/.ssh/id_rsa.pub)</span>"</span> &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span> $(ssh-agent -s)</span><br><span class="line"></span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line">chmod 0600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<hr>
<p>将以下包上传到<code>/usr/local</code>下面</p>
<ul>
<li><strong>jdk-8u211-linux-x64.tar.gz</strong></li>
<li><strong>scala-2.11.8.tgz</strong></li>
<li><strong>hadoop-2.7.2.tar.gz</strong></li>
<li><strong>apache-hive-1.2.1-bin.tar.gz</strong></li>
<li><strong>spark-2.4.3-bin-2.7.2hive.tgz</strong></li>
</ul>
<p>将以下包上传到用户目录下（这里我直接上传到<code>/home/hadoop</code>下）</p>
<ul>
<li><strong>nginx-1.18.0-1.el7.ngx.x86_64.rpm</strong></li>
<li><strong>dss_linkis.zip</strong></li>
</ul>
<hr>
<h2 id="配置阿里云镜像源"><a href="#配置阿里云镜像源" class="headerlink" title="配置阿里云镜像源"></a>配置阿里云镜像源</h2><p>Base</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"><span class="comment">#下载阿里云Base Repo</span></span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#清除缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新缓存</span></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<p>EPEL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装epel</span></span><br><span class="line">yum install epel-release -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份epel repo</span></span><br><span class="line">mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup</span><br><span class="line">mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载阿里云epel repo</span></span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#清除缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新缓存</span></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>

<h2 id="Java，Scala，Nginx安装"><a href="#Java，Scala，Nginx安装" class="headerlink" title="Java，Scala，Nginx安装"></a>Java，Scala，Nginx安装</h2><p>安装java  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">tar -zxvf jdk-8u211-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建软连接</span></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/jdk1.8.0_211 /usr/<span class="built_in">local</span>/java</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置环境变量</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#刷新</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看java版本</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>安装scala  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压spark包</span></span><br><span class="line">tar -zxvf scala-2.11.8.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/scala-2.11.8 /usr/<span class="built_in">local</span>/scala</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改环境变量</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/scala</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$SCALA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#刷新环境变量</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看scala版本</span></span><br><span class="line">scala -version</span><br></pre></td></tr></table></figure>

<p>安装nginx  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rpm安装nginx</span></span><br><span class="line">rpm -ivh nginx-1.18.0-1.el7.ngx.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动nginx</span></span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果有安装docker，先remove</span></span><br><span class="line">yum remove docker docker-common docker-selinux docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装一些依赖</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载docker repo文件</span></span><br><span class="line">curl -o /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#把软件仓库地址替换为 TUNA</span></span><br><span class="line">sed -i <span class="string">'s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成缓存</span></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看docker-ce可用版本</span></span><br><span class="line">yum list --showduplicates docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment">#最后安装</span></span><br><span class="line">yum install docker-ce-19.03.14-3.el7</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置docker的daemon.json</span></span><br><span class="line">mkdir /etc/docker </span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [<span class="string">"http://hub-mirror.c.163.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#开机启动docker</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<h2 id="Mysql安装和初始化"><a href="#Mysql安装和初始化" class="headerlink" title="Mysql安装和初始化"></a>Mysql安装和初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建mysql目录</span></span><br><span class="line">mkdir mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载docker-compose</span></span><br><span class="line">curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.25.5/docker-compose-<span class="variable">$(uname -s)</span>-<span class="variable">$(uname -m)</span>"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose &amp;&amp; \</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql docker-compose配置</span></span><br><span class="line">cat &gt; mysql/docker-compose.yml&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">    mysql:</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        container_name: mysql</span><br><span class="line">        ports:</span><br><span class="line">            - <span class="string">"3306:3306"</span></span><br><span class="line">        volumes:</span><br><span class="line">            - <span class="string">"/mysql_data:/var/lib/mysql"</span></span><br><span class="line">            - <span class="string">"/mysql_init_data:/docker-entrypoint-initdb.d"</span></span><br><span class="line">        restart: always</span><br><span class="line">        environment:</span><br><span class="line">            - MYSQL_ROOT_PASSWORD=Csstsari107!</span><br><span class="line">            - TZ=Asia/Shanghai</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">            [</span><br><span class="line">                <span class="string">"mysqld"</span>,</span><br><span class="line">                <span class="string">"--character-set-server=utf8mb4"</span>,</span><br><span class="line">                <span class="string">"--collation-server=utf8mb4_general_ci"</span>,</span><br><span class="line">                <span class="string">"--sql_mode="</span></span><br><span class="line">            ]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动mysql容器</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment">#宿主机安装mysql-client</span></span><br><span class="line">yum install mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#默认密码是Csstsari107</span></span><br><span class="line">mysql -h 127.0.0.1 -P 3306 -uroot -p</span><br></pre></td></tr></table></figure>

<p>创建数据库<strong>dss</strong>和<strong>hive</strong>，后面会用到。（下面是mysql终端执行）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> dss <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> hive <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>

<h2 id="Hadoop-Hive-Spark环境变量配置"><a href="#Hadoop-Hive-Spark环境变量配置" class="headerlink" title="Hadoop,Hive,Spark环境变量配置"></a>Hadoop,Hive,Spark环境变量配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 环境变量</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#hadoop home和config</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/hadoop</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop</span><br><span class="line"></span><br><span class="line"><span class="comment">#hive home和config</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/hive</span><br><span class="line"><span class="built_in">export</span> HIVE_CONF_DIR=<span class="variable">$HIVE_HOME</span>/conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#spark home和config</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/spark</span><br><span class="line"><span class="built_in">export</span> SPARK_CONF_DIR=<span class="variable">$SPARK_HOME</span>/conf</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$HIVE_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p><strong>请保持Hadoop，Hive，Spark的软链接目录和安装目录权限都是hadoop，包括后边复制的jar包，执行初始化等等</strong></p>
<h2 id="安装Hadoop"><a href="#安装Hadoop" class="headerlink" title="安装Hadoop"></a>安装Hadoop</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压hadoop包</span></span><br><span class="line">tar -zxvf hadoop-2.7.2.tar.gz</span><br><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line">ln -s hadoop-2.7.2 hadoop</span><br></pre></td></tr></table></figure>
<p>修改core-site.xml<br><code>vim hadoop/etc/hadoop/core-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://centos7test:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/hadoop_data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改hadoop-env.sh</span></span><br><span class="line">vim hadoop/etc/hadoop/hadoop-env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=/usr/<span class="built_in">local</span>/hadoop/etc/hadoop</span><br></pre></td></tr></table></figure>

<p>修改hdfs-site.xml<br><code>vim hadoop/etc/hadoop/hdfs-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/hadoop_data/hdfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/hadoop_data/hdfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改mapred-site.xml</span></span><br><span class="line">cp hadoop/etc/hadoop/mapred-site.xml.template hadoop/etc/hadoop/mapred-site.xml</span><br><span class="line"></span><br><span class="line">vim hadoop/etc/hadoop/mapred-site.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#修改slaves</span></span><br><span class="line">vim hadoop/etc/hadoop/slaves</span><br><span class="line"></span><br><span class="line">centos7test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改yarn-site.xml</span></span><br><span class="line">vim hadoop/etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--内存限制 16G--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16384<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--cpu限制 16核--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:8033<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos7test:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.config.diry<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/etc/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改目录所有者</span></span><br><span class="line">chown -R hadoop:hadoop hadoop hive spark</span><br><span class="line">chown -R hadoop:hadoop hadoop-2.7.2 apache-hive-1.2.1-bin spark-2.4.3-bin-2.7.2hive</span><br><span class="line"></span><br><span class="line">su hadoop</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">hadoop/bin/hdfs namenode -format</span><br><span class="line"></span><br><span class="line">hadoop/sbin/start-dfs.sh</span><br><span class="line">hadoop/sbin/start-yarn.sh</span><br></pre></td></tr></table></figure>

<h2 id="安装Hive"><a href="#安装Hive" class="headerlink" title="安装Hive"></a>安装Hive</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压hive包</span></span><br><span class="line">tar -zxvf apache-hive-1.2.1-bin.tar.gz</span><br><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line">ln -s apache-hive-1.2.1-bin hive</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line"></span><br><span class="line">cp hive/conf/hive-default.xml.template hive/conf/hive-site.xml</span><br><span class="line">vim hive/conf/hive-site.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换下面属性</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://centos7test:3306/hive?createDatabaseIfNotExist=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>useSSL=false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>Csstsari107!<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#替换变量$&#123;system:java.io.tmpdir&#125;和$&#123;system:user.name&#125;</span></span><br><span class="line">:%s<span class="comment">#$&#123;system:java.io.tmpdir&#125;#/usr/local/hive/tmp#g</span></span><br><span class="line">:%s<span class="comment">#$&#123;system:user.name&#125;#hive#g</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制mysql驱动包到$HIVE_HOME/lib/下面</span></span><br><span class="line">cp /root/mysql-connector-java-5.1.44.jar <span class="variable">$HIVE_HOME</span>/lib/ &amp;&amp; \</span><br><span class="line">chown -R hadoop:hadoop <span class="variable">$HIVE_HOME</span>/lib/mysql-connector-java-5.1.44.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化metastore（前提需要先创建数据库hive）</span></span><br><span class="line">hive/bin/schematool -dbType mysql -initSchema</span><br></pre></td></tr></table></figure>

<h2 id="安装Spark"><a href="#安装Spark" class="headerlink" title="安装Spark"></a>安装Spark</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压spark包</span></span><br><span class="line">tar -zxvf spark-2.4.3-bin-2.7.2hive.tgz</span><br><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line">ln -s spark-2.4.3-bin-hadoop2.7 spark</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改</span></span><br><span class="line">cp spark/conf/spark-env.sh.template spark/conf/spark-env.sh</span><br><span class="line"></span><br><span class="line">vim spark/conf/spark-env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> SPARK_MASTER_IP=centos7test <span class="comment">#主机名</span></span><br><span class="line"><span class="built_in">export</span> SPARK_WORKER_CORES=2</span><br><span class="line"><span class="built_in">export</span> SPARK_WORKER_MEMORY=2g</span><br><span class="line"></span><br><span class="line"><span class="comment">#hadoop home和config</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/hadoop</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop</span><br><span class="line"><span class="comment">#hive home和config</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/hive</span><br><span class="line"><span class="built_in">export</span> HIVE_CONF_DIR=<span class="variable">$HIVE_HOME</span>/conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改slaves</span></span><br><span class="line">cp spark/conf/slaves.template spark/conf/slaves</span><br><span class="line">vim spark/conf/slaves</span><br><span class="line">centos7test</span><br><span class="line"></span><br><span class="line"><span class="comment">#复制mysql驱动 链接到 $SPARK_HOME/jars/下</span></span><br><span class="line">ln -s <span class="variable">$HIVE_HOME</span>/lib/mysql-connector-java-5.1.44.jar <span class="variable">$SPARK_HOME</span>/jars/mysql-connector-java-5.1.44.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">#将hive的配置文件 创建软连接 spark配置目录下面</span></span><br><span class="line">ln -s <span class="variable">$HIVE_HOME</span>/conf/hive-site.xml <span class="variable">$SPARK_HOME</span>/conf/hive-site.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动spark-shell</span></span><br><span class="line">spark/bin/spark-shell --jars <span class="variable">$SPARK_HOME</span>/jars/mysql-connector-java-5.1.44.jar</span><br></pre></td></tr></table></figure>

<h2 id="DSS安装"><a href="#DSS安装" class="headerlink" title="DSS安装"></a>DSS安装</h2><p>依赖项：</p>
<ul>
<li>mysql-client</li>
<li>nginx</li>
<li>expect</li>
<li>dos2unix</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装DSS需要的工具</span></span><br><span class="line">yum install expect dos2unix unzip telnet -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#解压dss_linkis.zip</span></span><br><span class="line">unzip -d dss dss_linkis.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入安装目录</span></span><br><span class="line"><span class="built_in">cd</span> dss</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改数据配置文件</span></span><br><span class="line">vim conf/db.sh</span><br><span class="line"></span><br><span class="line">MYSQL_HOST=centos7test</span><br><span class="line">MYSQL_PORT=3306</span><br><span class="line">MYSQL_DB=dss</span><br><span class="line">MYSQL_USER=root</span><br><span class="line">MYSQL_PASSWORD=Csstsari107!</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改安装配置文件</span></span><br><span class="line">cp conf/config.sh.standard.template conf/config.sh</span><br><span class="line">vim conf/config.sh</span><br></pre></td></tr></table></figure>
<p>文件<code>config.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##########################################################################################</span></span><br><span class="line"><span class="comment">#######################  Must provided Configurations  ###################################</span></span><br><span class="line"><span class="comment">##########################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The install home path of Linkis</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#Actively load user env</span></span><br><span class="line"></span><br><span class="line">SSH_PORT=22</span><br><span class="line"></span><br><span class="line">deployUser=<span class="string">"`whoami`"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Specifies the user workspace, which is used to store the user's script files and log files.</span></span><br><span class="line"><span class="comment">### Generally local directory</span></span><br><span class="line">WORKSPACE_USER_ROOT_PATH=file:///home/hadoop/linkis/ <span class="comment">##file:// required</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### User's root hdfs path</span></span><br><span class="line">HDFS_USER_ROOT_PATH=hdfs:///home/hadoop/linkis <span class="comment">##hdfs:// required</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Path to store job ResultSet:file or hdfs path</span></span><br><span class="line">RESULT_SET_ROOT_PATH=hdfs:///home/hadoop/linkis</span><br><span class="line"></span><br><span class="line"><span class="comment"># Used to store the azkaban project transformed by DSS</span></span><br><span class="line">WDS_SCHEDULER_PATH=file:///home/hadoop/wds/scheduler</span><br><span class="line"></span><br><span class="line"><span class="comment">#DSS Web</span></span><br><span class="line">DSS_NGINX_IP=127.0.0.1</span><br><span class="line">DSS_WEB_PORT=9999</span><br><span class="line"></span><br><span class="line"><span class="comment">###azkaban  address for check</span></span><br><span class="line">AZKABAN_ADRESS_IP=127.0.0.1</span><br><span class="line">AZKABAN_ADRESS_PORT=8081</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">####qualitis address for check</span></span><br><span class="line">QUALITIS_ADRESS_IP=127.0.0.1</span><br><span class="line">QUALITIS_ADRESS_PORT=8090</span><br><span class="line"></span><br><span class="line"><span class="comment">##hive metastore</span></span><br><span class="line">HIVE_META_URL=jdbc:mysql://centos7test:3306/hive?useUnicode=<span class="literal">true</span></span><br><span class="line">HIVE_META_USER=root</span><br><span class="line">HIVE_META_PASSWORD=Csstsari107!</span><br><span class="line"></span><br><span class="line"><span class="comment">###HADOOP CONF DIR</span></span><br><span class="line">HADOOP_CONF_DIR=/usr/<span class="built_in">local</span>/hadoop/etc/hadoop</span><br><span class="line"></span><br><span class="line"><span class="comment">###HIVE CONF DIR</span></span><br><span class="line">HIVE_CONF_DIR=/usr/<span class="built_in">local</span>/hive/conf</span><br><span class="line"></span><br><span class="line"><span class="comment">###SPARK CONF DIR</span></span><br><span class="line">SPARK_CONF_DIR=/usr/<span class="built_in">local</span>/spark/conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################</span></span><br><span class="line"><span class="comment">####The following parameters can be modified by the user as required, but not necessary###</span></span><br><span class="line"><span class="comment">##########################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## LDAP is for enterprise authorization, if you just want to have a try, ignore it.</span></span><br><span class="line"><span class="comment">#LDAP_URL=ldap://localhost:1389/</span></span><br><span class="line"><span class="comment">#LDAP_BASEDN=dc=webank,dc=com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## java application default jvm memory</span></span><br><span class="line"><span class="built_in">export</span> SERVER_HEAP_SIZE=<span class="string">"512M"</span></span><br><span class="line"></span><br><span class="line">LINKIS_VERSION=0.9.4</span><br><span class="line"></span><br><span class="line">DSS_VERSION=0.9.0</span><br></pre></td></tr></table></figure>

<p>将引擎的启动参数调整一下<br>例如：<br><code>linkis/linkis-ujes-xxx-enginemanager</code>文件下的<code>conf/linkis.properties</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用于指定xxxEM启动的所有引擎的客户端的总内存</span></span><br><span class="line">wds.linkis.enginemanager.memory.max=8G</span><br><span class="line"><span class="comment">#用于指定xxxEM启动的所有引擎的客户端的总CPU核数</span></span><br><span class="line">wds.linkis.enginemanager.cores.max=8</span><br><span class="line"><span class="comment">#用于指定xxxEM可以启动的引擎个数</span></span><br><span class="line">wds.linkis.enginemanager.engine.instances.max=8</span><br></pre></td></tr></table></figure>

<h2 id="DSS启动"><a href="#DSS启动" class="headerlink" title="DSS启动"></a>DSS启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin&#x2F;start-all.sh</span><br></pre></td></tr></table></figure>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>1.nginx访问出现403，将/etc/nginx/nginx.conf中的user改为hadoop  </p>
<p>2.数据库刷不出来，hive终端授权<code>grant all on database default to user hadoop;</code></p>
<p>3.获取Yarn队列信息异常将linkis-resourcemanager-server-0.9.4.jar包替换一下</p>


<!--<a href="https://luxiang.org/2020/12/08/dss%E9%83%A8%E7%BD%B2/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
    <script src="http://s4.cnzz.com/stat.php?id=&web_id="
        language="JavaScript"></script>script>
</div>


<script src="/js/jquery-3.5.1.min.js"></script>
<script src="/js/clipboard.min.js"></script>
<script src="/js/clipboard-use.js"></script>

    <script src='https://unpkg.com/mermaid@8.9.1/dist/mermaid.min.js'></script>
    <script>
      if (window.mermaid) {
        mermaid.initialize({theme: 'forest'});
      }
    </script>
  



</body>
</html>